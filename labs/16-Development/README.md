# Development lab exercises

Welcome to the Development lab exercises. During the lab exercises the student will experiential work through various tasks and activities to gain practical experience and develop new skills. In hands-on learning, attendees are given the opportunity to explore, experiment, and discover knowledge for themselves about OpenSearch.

The goal is to get actively engage and ask questions if something is not clear or you are blocked. Important to understand that there are no strong dependencies between labs, so it's okay if you're behind and follow your own pace.

The following key topics are part of these exercises:

- Scripted Fields

## Exercise 1 - Scripted Fields

This exercise explains how to use a Scripted Fields to create additional fields generated by OpenSearch Dashboards. Most of this content is inspired by [Scripted Fields blogs by Elastic(2015)](https://www.elastic.co/blog/using-painless-kibana-scripted-fields). Always start developing on a development or sandbox environment.

**Warning** : Important to keep in mind `Scripted Fields` can impact the performance due per-request calculation!


### Exercise 1.1 - Substract substring from field value

This exercise you are going to extract a substring from a field value without using RegEx. RegEx is disabled and should be kept that way.

Take the following value value as example.  We just want to keep *PricingService*. 

`com.appx.company.pricing.service.impl.PricingService`

This can be done using a scripted field added to the **Index Pattern** under **Index Patterns**/**Stack Management**. See the following configuration below.

**Language:** Painless
**Type:** String
**Format:** String
**Transform:** None (default)
**Popularity:** 0 (default)

**Script**
```
def businessprocess = ""; 
def path = doc["logs.loggerName.keyword"].value;
if (path != null) {
  def len = path.length();
  def first = path.lastIndexOf("."); first = first+1;
  businessprocess = path.substring(first,len);
  return businessprocess;
}
return "";
```

Example snippet of Scripted field UI.

 <img src="https://raw.githubusercontent.com/avwsolutions/opensearch-training-material/main/labs/16-Development/content/scriptedfield.png" alt="scriptedfield">

 
 ### Exercise 1.2 - Other useful snippets 

Above we showed you an advanced Painless script, but easier use cases are also possible. Think about calculations,

 **Calculation of monthly price on yearly subscription**

 ```
doc['subscription_price'].value / 12
 ```

**Returning values from Field APIs**

```
doc['@timestamp'].date.dayOfYear
```

More info on [Field API expressions]https://www.elastic.co/guide/en/elasticsearch/reference/8.7/modules-scripting-expression.html#_date_field_api).

**Combining two fields, question and answer**

```
doc['question.keyword'].value + ':' + doc['answer.keyword'].value
```

**Return value on certain condition**

```
if (doc['memory'].value < 64000) { 
    return "Please upgrade your memory";
}
return "";
```

**Return value on certain condition**

```
if (doc['memory'].value < 64000) { 
    return "Please upgrade your memory";
}
return "";
```

**Multiple match options available**

Return a string "warn" if a substring "warn" is found in field "level", otherwise return a string "no warn".
```
if (doc['level.keyword'].value =~ /warn/) { 
  return "warn"
} else {
return "no warn"
}
```

Return domain, the string after the last dot in the "hostname" field.
```
def m = /^.*\.([a-z]+)$/.matcher(doc['hostname.keyword'].value);
if ( m.matches() ) {
   return m.group(1)
} else {
   return "no match"
}
```

Return the first octet of the IP address (stored in ip as a string) and treat it as a number.
```
def m = /^([0-9]+)\..*$/.matcher(doc['ip.keyword'].value);
if ( m.matches() ) {
   return Integer.parseInt(m.group(1))
} else {
   return 0
}
```

## Next Steps

You are finished with all hands-on labs about OpenSearch. Hopefully you liked the course labs and we met your expections. It's time to close your laptop and enjoy the newly learned skills and knowledge about analytics and text analysis with OpenSearch.

Enjoy the exercises!!!